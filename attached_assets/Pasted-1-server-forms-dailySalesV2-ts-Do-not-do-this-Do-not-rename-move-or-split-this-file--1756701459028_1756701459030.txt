1. server/forms/dailySalesV2.ts
// Do not do this:
// – Do not rename, move, or split this file
// – Do not change schema, DB, or table names
// – Do not add dependencies
// – Only apply exactly what is written below

import { Request, Response } from "express";
import pool from "@/server/db"; // using pool.query after agent change
import { toCents, fromCents } from "@/lib/utils";

// Existing createDailySalesV2 stays unchanged

export async function listDailySalesV2(req: Request, res: Response) {
  try {
    const result = await pool.query(
      `SELECT id, created_at, payload FROM daily_sales_v2 ORDER BY created_at DESC LIMIT 100`
    );

    const mapped = result.rows.map((row: any) => {
      const p = row.payload || {};
      return {
        id: row.id,
        date: row.created_at,
        staff: p.completedBy || "",
        cashStart: fromCents(p.startingCash || 0),
        cashEnd: fromCents(p.closingCash || 0),
        totalSales: fromCents(p.totalSales || 0),
        buns: p.bunsEnd || "-",  // expects Form 2 integration
        meat: p.meatEnd || "-",  // expects Form 2 integration
        status: "Submitted",
      };
    });

    res.json({ ok: true, records: mapped });
  } catch (err) {
    console.error("Daily Sales V2 list error", err);
    res.status(500).json({ ok: false, error: "Failed to list records" });
  }
}

2. client/src/pages/operations/daily-sales/Library.tsx
// Do not do this:
// – Do not rename, move, or split this file
// – Do not change API routes
// – Do not add dependencies
// – Only apply exactly what is written below

import React, { useEffect, useState } from "react";
import { thb } from "@/lib/utils";

type RecordType = {
  id: string;
  date: string;
  staff: string;
  cashStart: number;
  cashEnd: number;
  totalSales: number;
  buns: string;
  meat: string;
  status: string;
};

export default function DailySalesLibrary() {
  const [records, setRecords] = useState<RecordType[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState("");

  useEffect(() => {
    async function fetchRecords() {
      try {
        const res = await fetch("/api/forms/daily-sales/v2");
        const data = await res.json();
        if (data.ok && data.records) {
          setRecords(data.records);
        } else {
          setError("No records found");
        }
      } catch (err) {
        setError("Network error");
      } finally {
        setLoading(false);
      }
    }
    fetchRecords();
  }, []);

  return (
    <div className="p-6">
      <h1 className="text-2xl font-extrabold font-[Poppins] mb-4">
        Daily Sales Library
      </h1>
      {loading && <p>Loading...</p>}
      {error && <p className="text-red-500">{error}</p>}
      <table className="min-w-full bg-white border border-gray-200 rounded-lg">
        <thead>
          <tr className="bg-gray-100 text-left text-sm font-semibold font-[Poppins]">
            <th className="p-2 border-b">Date</th>
            <th className="p-2 border-b">Staff</th>
            <th className="p-2 border-b">Cash Start</th>
            <th className="p-2 border-b">Cash End</th>
            <th className="p-2 border-b">Total Sales</th>
            <th className="p-2 border-b">Buns (End)</th>
            <th className="p-2 border-b">Meat (End)</th>
            <th className="p-2 border-b">Status</th>
          </tr>
        </thead>
        <tbody>
          {records.length === 0 ? (
            <tr>
              <td colSpan={8} className="p-4 text-center text-gray-500">
                No records found
              </td>
            </tr>
          ) : (
            records.map((rec) => (
              <tr key={rec.id} className="text-sm font-[Poppins]">
                <td className="p-2 border-b">
                  {new Date(rec.date).toLocaleDateString()}
                </td>
                <td className="p-2 border-b">{rec.staff}</td>
                <td className="p-2 border-b">{thb(rec.cashStart)}</td>
                <td className="p-2 border-b">{thb(rec.cashEnd)}</td>
                <td className="p-2 border-b">{thb(rec.totalSales)}</td>
                <td className="p-2 border-b">{rec.buns}</td>
                <td className="p-2 border-b">{rec.meat}</td>
                <td className="p-2 border-b">{rec.status}</td>
              </tr>
            ))
          )}
        </tbody>
      </table>
    </div>
  );
}
