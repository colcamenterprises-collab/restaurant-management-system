ğŸ¯ Objective:
Update the /receipts page in the Smash Brothers Burgers dashboard to include a permanent receipt ID summary section with:

First and last receipt numbers for the shift

Total number of receipts

Gross & Net sales

Breakdown by payment types

Ability to download full receipt list as CSV

ğŸ“ Files To Update:
server/routes/receipts.ts

client/src/pages/ReceiptsPage.tsx (or similar if named differently)

Add Download CSV utility

1. âœ… BACKEND â€“ Update receipts.ts API
ğŸ“„ server/routes/receipts.ts

Add endpoint to fetch receipt summary (already partially done) + receipt IDs:

ts
Copy
Edit
router.get("/summary-with-ids", async (req, res) => {
  const date = req.query.date || getCurrentShiftDate(); // Get today's shift

  const result = await db.query(`
    SELECT
      COUNT(*) AS total_receipts,
      SUM(total_amount) AS gross_sales,
      SUM(net_amount) AS net_sales,
      MIN(receipt_number) AS first_receipt,
      MAX(receipt_number) AS last_receipt
    FROM loyverse_receipts
    WHERE created_at AT TIME ZONE 'Asia/Bangkok'
      BETWEEN '${date} 17:00:00+07' AND '${getNextDay(date)} 03:00:00+07'
  `);

  const paymentTypes = await db.query(`
    SELECT payment_method, COUNT(*) AS count
    FROM loyverse_receipts
    WHERE created_at AT TIME ZONE 'Asia/Bangkok'
      BETWEEN '${date} 17:00:00+07' AND '${getNextDay(date)} 03:00:00+07'
    GROUP BY payment_method
  `);

  res.json({
    ...result.rows[0],
    payment_breakdown: paymentTypes.rows
  });
});
2. âœ… FRONTEND â€“ Add Receipt Summary Display
ğŸ“„ client/src/pages/ReceiptsPage.tsx

Add this to top of the page, under the header:

tsx
Copy
Edit
const [summary, setSummary] = useState(null);

useEffect(() => {
  axios.get("/api/receipts/summary-with-ids").then((res) => {
    setSummary(res.data);
  });
}, []);

{summary && (
  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
    <div className="bg-white p-4 rounded shadow">
      <strong>ğŸ§¾ Receipt Range:</strong><br />
      {summary.first_receipt} â†’ {summary.last_receipt}
    </div>
    <div className="bg-white p-4 rounded shadow">
      <strong>Total Receipts:</strong><br />
      {summary.total_receipts}
    </div>
    <div className="bg-white p-4 rounded shadow">
      <strong>Gross Sales:</strong><br /> à¸¿{Number(summary.gross_sales).toFixed(2)}<br />
      <strong>Net Sales:</strong><br /> à¸¿{Number(summary.net_sales).toFixed(2)}
    </div>
    <div className="bg-white p-4 rounded shadow col-span-3">
      <strong>ğŸ’³ Payment Types:</strong>
      <ul className="mt-2">
        {summary.payment_breakdown.map((p: any, idx: number) => (
          <li key={idx}>
            {p.payment_method}: {p.count}
          </li>
        ))}
      </ul>
    </div>
    <div className="col-span-3">
      <button
        onClick={() => window.location.href = "/api/receipts/download"}
        className="bg-black text-white px-4 py-2 rounded hover:bg-gray-800"
      >
        â¬‡ï¸ Download Full Receipt CSV
      </button>
    </div>
  </div>
)}
3. âœ… ADD DOWNLOAD CSV ENDPOINT (If Not Yet Added)
In receipts.ts, add:

ts
Copy
Edit
router.get("/download", async (req, res) => {
  const receipts = await db.query(`SELECT * FROM loyverse_receipts ORDER BY created_at ASC`);
  const csv = Papa.unparse(receipts.rows); // Use papaparse or similar CSV lib

  res.setHeader("Content-Disposition", "attachment; filename=receipts.csv");
  res.setHeader("Content-Type", "text/csv");
  res.send(csv);
});
ğŸ§ª Testing Instructions:
Start backend and run /api/receipts/summary-with-ids

Visit /receipts page and confirm:

First & Last receipt shown

Payment breakdown shown

Button downloads a .csv file

Test full day shift boundary: 5PM â€“ 3AM BKK

