Fix Applied: Manual Cash in Register
Removed auto-calc for cashInRegister—now staff manual input. Added optional validation on submit: If manual != calculated (startingCash + cashSales - totalExpenses), show warning toast ("Cash doesn't match calc—verify") but allow submit. Logs anomaly for security.
Updated Code for DailyStockSales.tsx (Replace useForm & Schema Section):
typescript

Collapse

Unwrap

Run

Copy
const formSchema = z.object({
  grabSales: z.coerce.number().min(0).optional().default(0),
  directSales: z.coerce.number().min(0).optional().default(0),
  aroiDeeSales: z.coerce.number().min(0).optional().default(0),
  qrScanSales: z.coerce.number().min(0).optional().default(0),
  cashSales: z.coerce.number().min(0).optional().default(0),
  totalSalesAmount: z.coerce.number().min(0).optional().default(0),
  salaryWages: z.coerce.number().min(0).optional().default(0),
  shopping: z.coerce.number().min(0).optional().default(0),
  gasExpense: z.coerce.number().min(0).optional().default(0),
  totalExpenses: z.coerce.number().min(0).optional().default(0),
  startingCash: z.coerce.number().min(0).optional().default(0),
  cashInRegister: z.coerce.number().min(0).optional().default(0),
});

const DailyStockSales = () => {
  const form = useForm({
    resolver: zodResolver(formSchema),
    defaultValues: {
      grabSales: 0,
      directSales: 0,
      aroiDeeSales: 0,
      qrScanSales: 0,
      cashSales: 0,
      totalSalesAmount: 0,
      salaryWages: 0,
      shopping: 0,
      gasExpense: 0,
      totalExpenses: 0,
      startingCash: 0,
      cashInRegister: 0,
    },
  });

  const { watch, setValue, setError } = form;
  const sales = watch(['grabSales', 'directSales', 'aroiDeeSales', 'qrScanSales', 'cashSales']);
  const expenses = watch(['salaryWages', 'shopping', 'gasExpense']);

  useEffect(() => {
    const salesTotal = sales.reduce((sum, val) => sum + Number(val || 0), 0);
    setValue('totalSalesAmount', salesTotal);
  }, [sales, setValue]);

  useEffect(() => {
    const expTotal = expenses.reduce((sum, val) => sum + Number(val || 0), 0);
    setValue('totalExpenses', expTotal);
  }, [expenses, setValue]);

  // On submit validation for cash (warning only)
  const onSubmit = (data) => {
    const calcCash = Number(data.startingCash || 0) + Number(data.cashSales || 0) - Number(data.totalExpenses || 0);
    if (Number(data.cashInRegister) !== calcCash) {
      setError('cashInRegister', { type: 'manual', message: `Cash doesn't match calc (${calcCash})—verify` });
      // Proceed to submit anyway - log anomaly
      console.log(`Anomaly: Manual cash ${data.cashInRegister} vs calc ${calcCash}`);
    }
    // Submit data
  };

  // ...rest
};
Update Cash Input JSX (Make Editable, Add Warning Label):
tsx

Collapse

Unwrap

Copy
<Input 
  type="number" 
  step="0.01" 
  placeholder="0.00" 
  {...register("cashInRegister")} 
/>
{form.formState.errors.cashInRegister && <p class="text-red-500">{form.formState.errors.cashInRegister.message}</p>}
Backend Log Anomaly (server/routes.ts - POST):
typescript

Collapse

Unwrap

Run

Copy
app.post("/api/daily-stock-sales", async (req: Request, res: Response) => {
  try {
    const data = req.body;
    const parsed = {
      ...data,
      grabSales: Number(data.grabSales || 0),
      // ...all numbers
    };
    const calcCash = Number(parsed.startingCash) + Number(parsed.cashSales) - Number(parsed.totalExpenses);
    if (Number(parsed.cashInRegister) !== calcCash) {
      console.log(`Anomaly log: Manual cash ${parsed.cashInRegister} vs calc ${calcCash}`);
      // Save anyway
    }
    const result = await storage.createDailyStockSales(parsed);
    res.json(result);
  } catch (err) {
    res.status(500).json({ error: "Failed" });
  }
});
Test Steps:
Save, restart app.
Enter sales/expenses—totals auto-update.
Enter startingCash 2500, cashSales 1200, totalExpenses 3330 (auto).
Enter cashInRegister 2500 (mismatch to calc 370—warning shows, submits, anomaly logged).
Check console/log for anomaly.
Proactive: Manual cash promotes honesty, warning/logs catch manipulation. Test & confirm—no auto for cash.