ðŸš¨ Fort Knox Patch â€“ Jussi WOW Daily Report
# ðŸš¨ DO NOT MODIFY WITHOUT CAMâ€™S APPROVAL ðŸš¨
# Jussi Daily Report â€“ Form vs POS Shift Report
# Agent Instructions:
# - Update ONLY files listed here.
# - Use existing utils (getShiftReport, getLoyverseReceipts).
# - No new deps, no extra files.
# - After implementation, run QA checklist and REPORT results.

--- update: server/services/summaryGenerator.js
+ import { db } from "../db/client";
+ import { dailyReceiptSummaries, daily_sales_v2, expenses, recipes } from "../db/schema";
+ import { getShiftReport, getLoyverseReceipts } from "../utils/loyverse";
+ import OpenAI from "openai";
+
+ const openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });
+
+ export async function generateJussiReport(date) {
+   // 1. Pull data sources
+   const shift = await getShiftReport({ date });       // âœ… Gross, Net, Discounts, Refunds, Cash Drawer
+   const receipts = await getLoyverseReceipts({ date });
+   const form = await db.query.daily_sales_v2.findFirst({ where: (t, { eq }) => eq(t.date, date) });
+   const purchases = await db.query.expenses.findMany({ where: (t, { eq }) => eq(t.date, date) });
+   const recipeList = await db.query.recipes.findMany();
+
+   // 2. Build OpenAI prompt
+   const prompt = `
+   You are Jussi, Head of Ops. Build a JSON management report for shift ${date}.
+   Compare Staff Form vs POS Shift Report, receipts, and recipes.
+
+   Required Output:
+   {
+     executiveSummary: "text summary, list mismatches",
+     salesVsPOS: [
+       { field: "Gross Sales", formValue, posValue, status },
+       { field: "Net Sales", formValue, posValue, status },
+       { field: "Cash Payments", formValue, posValue, status },
+       { field: "Cash Refunds", formValue, posValue, status },
+       { field: "Paid In", formValue, posValue, status },
+       { field: "Paid Out", formValue, posValue, status },
+       { field: "Expected Cash", formValue, posValue, status },
+       { field: "Actual Cash", formValue, posValue, status },
+       { field: "Difference", formValue, posValue, status },
+       { field: "Discounts", formValue, posValue, status },
+       { field: "Refunds", formValue, posValue, status }
+     ],
+     stockUsage: [
+       { item: "Rolls", expected, actual, variance, status },
+       { item: "Meat", expected, actual, variance, status },
+       { item: "Drinks", expected, actual, variance, status }
+     ],
+     basketBreakdown: { burgers, sides, modifiers },
+     top5Items: [{ item, qty }],
+     paymentBreakdown: [{ method, amount }],
+     flags: [ "list anomalies here" ]
+   }
+
+   Rules:
+   - Rolls tolerance: Â±4
+   - Meat tolerance: Â±500g
+   - Drinks tolerance: Â±2 units
+   - Flag mismatches with ðŸš¨, balanced with âœ…
+
+   Inputs:
+   - Shift Report: ${JSON.stringify(shift)}
+   - Staff Form: ${JSON.stringify(form)}
+   - Receipts: ${JSON.stringify(receipts)}
+   - Purchases: ${JSON.stringify(purchases)}
+   - Recipes: ${JSON.stringify(recipeList)}
+   `;
+
+   const resp = await openai.chat.completions.create({
+     model: "gpt-4o",
+     messages: [
+       { role: "system", content: "You are Jussi, operations AI. Output ONLY valid JSON." },
+       { role: "user", content: prompt }
+     ],
+   });
+
+   const data = JSON.parse(resp.choices[0].message.content);
+
+   // 3. Save to DB
+   await db.insert(dailyReceiptSummaries)
+     .values({ shiftDate: date, data })
+     .onConflictDoUpdate({ target: dailyReceiptSummaries.shiftDate, set: { data } });
+
+   return data;
+ }

--- update: client/src/pages/operations/Analysis.tsx
+ import { useEffect, useState } from "react";
+
+ export default function AnalysisPage() {
+   const [jussiData, setJussiData] = useState<any>(null);
+
+   useEffect(() => {
+     async function fetchData() {
+       const res = await fetch("/api/jussi/latest");
+       const json = await res.json();
+       setJussiData(json.data);
+     }
+     fetchData();
+   }, []);
+
+   return (
+     <div className="p-6">
+       <h1 className="text-2xl font-bold mb-4">Daily Analysis</h1>
+
+       {jussiData && (
+         <div className="mb-6 border rounded-lg p-4 bg-gray-100">
+           <h2 className="text-xl font-semibold">Jussi Daily Report</h2>
+           <p className="text-sm text-gray-600">{jussiData.executiveSummary}</p>
+
+           <h3 className="font-semibold mt-4">Sales vs POS</h3>
+           <table className="w-full text-sm mb-4">
+             <thead><tr><th>Field</th><th>Form</th><th>POS</th><th>Status</th></tr></thead>
+             <tbody>
+               {jussiData.salesVsPOS?.map((s, idx) => (
+                 <tr key={idx} className={s.status.includes("ðŸš¨") ? "text-red-600" : "text-green-600"}>
+                   <td>{s.field}</td><td>{s.formValue}</td><td>{s.posValue}</td><td>{s.status}</td>
+                 </tr>
+               ))}
+             </tbody>
+           </table>
+
+           <h3 className="font-semibold mt-4">Stock Usage</h3>
+           <table className="w-full text-sm mb-4">
+             <thead><tr><th>Item</th><th>Expected</th><th>Actual</th><th>Variance</th><th>Status</th></tr></thead>
+             <tbody>
+               {jussiData.stockUsage?.map((s, idx) => (
+                 <tr key={idx} className={s.status.includes("ðŸš¨") ? "text-red-600" : "text-green-600"}>
+                   <td>{s.item}</td><td>{s.expected}</td><td>{s.actual}</td><td>{s.variance}</td><td>{s.status}</td>
+                 </tr>
+               ))}
+             </tbody>
+           </table>
+
+           <h3 className="font-semibold mt-4">Basket of Goods</h3>
+           <p>Burgers: {jussiData.basketBreakdown?.burgers || 0}, Sides: {jussiData.basketBreakdown?.sides || 0}, Modifiers: {jussiData.basketBreakdown?.modifiers || 0}</p>
+
+           <h3 className="font-semibold mt-4">Top 5 Items</h3>
+           <ul>{jussiData.top5Items?.map((i, idx) => <li key={idx}>{i.item} â€“ {i.qty}</li>)}</ul>
+
+           <h3 className="font-semibold mt-4">Payment Breakdown</h3>
+           <ul>{jussiData.paymentBreakdown?.map((p, idx) => <li key={idx}>{p.method}: {p.amount}</li>)}</ul>
+
+           <h3 className="font-semibold mt-4 text-red-600">Flags</h3>
+           <ul>{jussiData.flags?.map((f, idx) => <li key={idx}>{f}</li>)}</ul>
+         </div>
+       )}
+
+       {/* Existing analysis content below */}
+     </div>
+   );
+ }
