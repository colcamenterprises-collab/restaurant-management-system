Replit Agent Instruction: Add Debug Logging to storeReceipt()
File: server/services/loyverseReceipts.ts
Target Function: storeReceipt

‚úÖ Updated storeReceipt() Code:
ts
Copy
Edit
export async function storeReceipt(receipt: any): Promise<void> {
  try {
    const {
      receipt_id,
      receipt_number,
      created_at,
      total_money,
      payment_type,
      customer_id,
      line_items,
      taxes,
      discounts,
    } = receipt;

    const shiftDate = calculateShiftDate(created_at);

    const insertQuery = `
      INSERT INTO loyverse_receipts (
        receipt_id,
        receipt_number,
        receipt_date,
        total_amount,
        payment_method,
        customer_info,
        items,
        tax_amount,
        discount_amount,
        shift_date
      ) VALUES (
        $1, $2, $3, $4, $5, $6, $7, $8, $9, $10
      )
      ON CONFLICT (receipt_id) DO NOTHING
    `;

    const values = [
      receipt_id,
      receipt_number,
      created_at,
      total_money || 0,
      payment_type || 'UNKNOWN',
      JSON.stringify({ customer_id: customer_id || null }),
      JSON.stringify(line_items || []),
      taxes?.reduce((sum: number, t: any) => sum + (t.amount || 0), 0) || 0,
      discounts?.reduce((sum: number, d: any) => sum + (d.amount || 0), 0) || 0,
      shiftDate,
    ];

    await db.query(insertQuery, values);
    console.log(`‚úÖ Stored receipt ${receipt_number} | Total: ${total_money}`);
  } catch (error: any) {
    console.error(`‚ùå Failed to store receipt: ${receipt.receipt_number || 'UNKNOWN'}`);
    console.error('‚û° Receipt data:', JSON.stringify(receipt, null, 2));
    console.error('‚û° Error:', error.message || error);
  }
}
üß† After Updating:
Re-run the receipt sync using:

bash
Copy
Edit
curl -X POST http://localhost:5000/api/loyverse/pull
Watch terminal output for:

‚úÖ Stored receipt ... (success)

‚ùå Failed to store receipt ... (error and cause)

Once you get the logs from this, send me a snippet if there's a failure ‚Äî I‚Äôll tell you exactly how to fix it and get those receipts into the DB. Let‚Äôs go.