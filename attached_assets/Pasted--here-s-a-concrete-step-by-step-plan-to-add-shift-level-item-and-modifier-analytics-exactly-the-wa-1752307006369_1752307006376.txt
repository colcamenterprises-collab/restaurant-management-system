 here’s a concrete, step-by-step plan to add shift-level, item-and-modifier analytics exactly the way you described.

1. Data Model – new tables
Table	Purpose	Key columns
shift_item_sales	1 row per item per shift	shift_date · category · item_name · qty · sales_total
shift_modifier_sales	1 row per modifier per shift	shift_date · modifier_name · qty · sales_total
shift_summary	1 row per shift	shift_date · burgers_sold · drinks_sold · sides_sold · extras_sold · other_sold · total_sales · total_receipts

Migrations: add three drizzle ORM table definitions and run npx drizzle-kit push.

2. Receipt-processing worker (runs at 03 : 00 BKK)
Pull receipts for previous shift

ts
Copy
Edit
const { receipts } =
  await loyverseReceiptService.getReceiptsByDateRange(shiftStartUTC, shiftEndUTC);
Explode each receipt into:

items: use your existing processReceiptItemsAndModifiers()

modifiers

Categorise

ts
Copy
Edit
const mapCategory = (name: string) => {
  const n = name.toLowerCase();
  if (n.includes('burger')) return 'BURGERS';
  if (['fries','rings','nugget','side'].some(w=>n.includes(w))) return 'SIDE ORDERS';
  if (['cheese','bacon','animal style'].some(w=>n.includes(w))) return 'BURGER EXTRAS';
  if (['coke','water','juice','beer','fanta','sprite'].some(w=>n.includes(w))) return 'DRINKS';
  return 'OTHER';
};
Aggregate into maps itemTotals & modifierTotals.

Persist (upsert) rows into the three new tables.

Write shift_summary (burgers sold etc.) from aggregation maps.

Implementation: add server/services/shiftAnalytics.ts with an exported processPreviousShift() function and schedule it with the existing 3 AM cron.

3. Searchable API endpoints
ts
Copy
Edit
// Get full breakdown for a shift (YYYY-MM-DD = 6 PM date)
GET /api/analysis/shift/:date

// Example response (trimmed)
{
  "shiftDate": "2025-07-11",
  "totals": { "burgers": 87, "drinks": 64, ... },
  "items": [
    { "category":"BURGERS", "name":"Double Smash", "qty":45, "sales":6750 },
    ...
  ],
  "modifiers": [
    { "name":"Animal Style", "qty":12, "sales":240 },
    ...
  ]
}

// Quick search over many shifts
GET /api/analysis/search?q=burger&from=2025-07-01&to=2025-07-12&cat=BURGERS
4. Frontend – Analysis page
New Shift selector (date-picker defaulting to yesterday’s shift).

Cards:

“Burgers sold” • “Drinks sold” • “Side orders” …

Tables (@tanstack/react-table):

Items table (category filter chips)

Modifiers table

Download CSV button (optional).

This is 100 % client-side; fetches /api/analysis/shift/:date and renders.

5. Task list for you / me
Task	Owner	Est.
Drizzle migrations (+ models)	me	15 min
shiftAnalytics.processPreviousShift() worker	me	45 min
Add cron to scheduler (03 : 00 BKK)	me	5 min
REST endpoints (list & search)	me	30 min
React UI components	you / me	60–90 min

