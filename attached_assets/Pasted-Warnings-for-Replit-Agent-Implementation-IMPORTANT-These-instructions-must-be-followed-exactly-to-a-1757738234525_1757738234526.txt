Warnings for Replit Agent Implementation
IMPORTANT: These instructions must be followed exactly to avoid issues like the previous dashboard failure. Do not deviate, add unsolicited features, or introduce complexity—this is for Replit's native backend (Node.js 18+, Express, PostgreSQL via Neon env vars). Stick to direct code updates in existing files; no new dependencies, no 3rd-party tools/wrappers (e.g., no Yup/Formik—use native React state). Prioritize data accuracy: Validations must prevent invalid submissions to ensure stock/security (e.g., no negative rolls). Test in Replit split terminals (npm run dev for client/server), verify no console errors, and confirm data flows accurately to email/library/shopping without duplicates. If unsure about Replit limits (e.g., env vars for SMTP), reference official docs via direct browse—do not assume or improvise. Implement in one pass; commit to repo after testing. Report any conflicts immediately without proceeding.
Updated Backend Fixes (server/api/forms/dailyStock.ts or routes.ts)
Add mandatory checks for rolls, meat, drinks. Return specific error messages for accuracy.
typescript// In POST /api/forms/daily-stock
import { db } from '../db';
import { daily_stock_v2 } from '../../shared/schema';

export const submitDailyStock = async (req, res) => {
  const data = req.body;
  const errors = [];
  if (!data.rollsEnd || data.rollsEnd < 0) errors.push('Rolls count is required and must be non-negative');
  if (!data.meatCount || data.meatCount < 0) errors.push('Meat count is required and must be non-negative');
  if (!data.drinksEnd || data.drinksEnd.length === 0) errors.push('Drinks counts are required (at least one item)');
  if (!data.requisition || data.requisition.length === 0) errors.push('Requisition items required');
  if (errors.length) {
    return res.status(400).json({ error: errors.join('; ') });
  }
  // Numeric enforcement (parse if needed for accuracy)
  data.rollsEnd = parseInt(data.rollsEnd, 10);
  data.meatCount = parseInt(data.meatCount, 10);
  // Insert...
  await db.insert(daily_stock_v2).values(data);
  // Trigger shopping/email as before
  res.json({ success: true });
};
Updated Frontend Fixes (client/src/pages/operations/DailyStock.tsx)
Integrate lockdowns: Mandatory inputs, type="number", error states/messages. Use consistent Tailwind (e.g., text-sm for labels, border-red-500 for highlights). Assume integrated with DailySalesForm.tsx as 2-step (e.g., via parent component or router).
tsximport { useState } from 'react';
import { useMutation } from '@tanstack/react-query';
import axios from 'axios';
import { LanguageToggle } from '../components/LanguageToggle'; // From previous

const labels = {
  en: { rollsEnd: 'Ending Rolls Count', meatCount: 'Meat Count', drinksEnd: 'Drinks Counts (JSON)', /* etc. */ },
  th: { rollsEnd: 'จำนวนม้วนสิ้นสุด', meatCount: 'จำนวนเนื้อ', drinksEnd: 'จำนวนเครื่องดื่ม (JSON)', /* Thai */ }
};

export const DailyStockForm = () => {
  const [lang, setLang] = useState('en');
  const [formData, setFormData] = useState({ rollsEnd: '', meatCount: '', drinksEnd: [], requisition: [] /* jsonb */ });
  const [errors, setErrors] = useState([]);
  const mutation = useMutation(data => axios.post('/api/forms/daily-stock', data));

  const handleChange = (field, value) => {
    setFormData({ ...formData, [field]: value });
  };

  const handleSubmit = () => {
    const newErrors = [];
    if (!formData.rollsEnd || parseInt(formData.rollsEnd) < 0) newErrors.push('rollsEnd');
    if (!formData.meatCount || parseInt(formData.meatCount) < 0) newErrors.push('meatCount');
    if (formData.drinksEnd.length === 0) newErrors.push('drinksEnd');
    if (formData.requisition.length === 0) newErrors.push('requisition');
    setErrors(newErrors);
    if (newErrors.length) {
      return; // Prevent submit
    }
    mutation.mutate(formData);
  };

  return (
    <div className="p-4 space-y-4">
      <LanguageToggle onChange={setLang} />
      <div>
        <label className="text-sm font-medium">{labels[lang].rollsEnd}</label>
        <input 
          type="number" 
          min="0" 
          value={formData.rollsEnd} 
          onChange={e => handleChange('rollsEnd', e.target.value)} 
          className={`border w-full p-2 ${errors.includes('rollsEnd') ? 'border-red-500' : ''}`} 
          placeholder="Enter non-negative number"
        />
        {errors.includes('rollsEnd') && <p className="text-red-500 text-sm">Rolls count is required and must be non-negative for accurate stock tracking and theft prevention.</p>}
      </div>
      <div>
        <label className="text-sm font-medium">{labels[lang].meatCount}</label>
        <input 
          type="number" 
          min="0" 
          value={formData.meatCount} 
          onChange={e => handleChange('meatCount', e.target.value)} 
          className={`border w-full p-2 ${errors.includes('meatCount') ? 'border-red-500' : ''}`} 
          placeholder="Enter non-negative number"
        />
        {errors.includes('meatCount') && <p className="text-red-500 text-sm">Meat count is required and must be non-negative to ensure inventory accuracy.</p>}
      </div>
      <div>
        <label className="text-sm font-medium">{labels[lang].drinksEnd}</label>
        {/* Assuming JSON editor or multi-input for jsonb; simple textarea for v1 */}
        <textarea 
          value={JSON.stringify(formData.drinksEnd)} 
          onChange={e => handleChange('drinksEnd', JSON.parse(e.target.value || '[]'))} 
          className={`border w-full p-2 ${errors.includes('drinksEnd') ? 'border-red-500' : ''}`} 
          placeholder='[{"drink":"Coke","qty":10}]'
        />
        {errors.includes('drinksEnd') && <p className="text-red-500 text-sm">At least one drink count is required for complete stock reconciliation.</p>}
      </div>
      {/* Requisition inputs as before */}
      <button onClick={handleSubmit} className="bg-blue-500 text-white p-2">Submit Stock</button>
      {errors.length > 0 && <p className="text-red-500">Form cannot submit due to missing/invalid fields. Please correct highlighted areas for data accuracy.</p>}
    </div>
  );
};
Updated Tests (add to your testApp.ts)
javascript// Add stock test
const stockRes = await axios.post('/api/forms/daily-stock', { rollsEnd: '', meatCount: -1, drinksEnd: [] });
console.log('Stock error (expected): ' + stockRes.data.error); // Should log specific warnings

const validStock = await axios.post('/api/forms/daily-stock', { rollsEnd: 50, meatCount: 20, drinksEnd: [{drink:'Coke',qty:10}], requisition: [{id:'item1',qty:2}] });
console.log('Valid stock success: ' + validStock.data.success);