Direct Fix for Required Fields Issue: The error is from React Hook Form + Zod enforcing min(1) or required on stock fields (e.g., drinks/food items). We'll make all stock counts optional (allow 0/blank = no purchase), default to 0 on submit. This keeps key fields like shiftDate/completedBy required.

Patch for client/src/pages/DailyStockSales.tsx: Replace the formSchema definition (around line 200-300) with this updated Zod schema. It makes stock fields z.number().min(0).optional(), defaults blank to 0 in onSubmit.

typescript

Collapse

Unwrap

Run

Copy
const formSchema = z.object({
  completedBy: z.string().min(1, "Required"),
  shiftType: z.enum(['opening', 'closing']), // Required
  shiftDate: z.string().datetime("Required"),
  startingCash: z.number().min(0).optional(), // Optional
  endingCash: z.number().min(0).optional(),
  grabSales: z.number().min(0).optional(),
  foodPandaSales: z.number().min(0).optional(),
  aroiDeeSales: z.number().min(0).optional(),
  qrScanSales: z.number().min(0).optional(),
  cashSales: z.number().min(0).optional(),
  totalSales: z.number().min(0).optional(),
  salaryWages: z.number().min(0).optional(),
  shopping: z.number().min(0).optional(),
  gasExpense: z.number().min(0).optional(),
  totalExpenses: z.number().min(0).optional(),
  wageEntries: z.array(z.object({ /* ... */ })).optional(),
  shoppingEntries: z.array(z.object({ item: z.string(), amount: z.number().min(0).optional() })).optional(),
  burgerBunsStock: z.number().min(0).optional(),
  rollsOrderedCount: z.number().min(0).optional(),
  meatWeight: z.number().min(0).optional(),
  drinkStockCount: z.number().min(0).optional(),
  freshFood: z.array(z.object({ name: z.string(), value: z.number().min(0).optional() })).optional(),
  frozenFood: z.array(z.object({ name: z.string(), value: z.number().min(0).optional() })).optional(),
  shelfItems: z.array(z.object({ name: z.string(), value: z.number().min(0).optional() })).optional(),
  drinkStock: z.array(z.object({ name: z.string(), value: z.number().min(0).optional() })).optional(),
  kitchenItems: z.array(z.object({ name: z.string(), value: z.number().min(0).optional() })).optional(),
  packagingItems: z.array(z.object({ name: z.string(), value: z.number().min(0).optional() })).optional(),
  isDraft: z.boolean().optional(),
});

// In onSubmit handler (around line 300-350), default blanks to 0
const onSubmit = (data) => {
  const defaults = {
    ...data,
    burgerBunsStock: data.burgerBunsStock || 0,
    rollsOrderedCount: data.rollsOrderedCount || 0,
    meatWeight: data.meatWeight || 0,
    drinkStockCount: data.drinkStockCount || 0,
    // Default arrays
    freshFood: data.freshFood.map(f => ({ ...f, value: f.value || 0 })),
    frozenFood: data.frozenFood.map(f => ({ ...f, value: f.value || 0 })),
    shelfItems: data.shelfItems.map(f => ({ ...f, value: f.value || 0 })),
    drinkStock: data.drinkStock.map(d => ({ ...d, value: d.value || 0 })),
    kitchenItems: data.kitchenItems.map(k => ({ ...k, value: k.value || 0 })),
    packagingItems: data.packagingItems.map(p => ({ ...p, value: p.value || 0 })),
  };
  // Submit defaults
};
UI Fix: In JSX for fields (e.g., drink inputs), remove required prop: <Input required={false} ... />. Red "Required" is from Zod—now gone with optional.

Test Steps:

Save patch, restart app (npm run dev).
Load form, leave non-key fields blank/0, submit—should succeed without error.
Check DB (SQL: SELECT * FROM daily_stock_sales ORDER BY id DESC LIMIT 1;)—blanks = 0.
If error persists, run:
bash

Collapse

Unwrap

Run

Copy
tsx client/src/pages/DailyStockSales.tsx --test-submit # Simulate if tool available
Share any new error.
Workflow Optimizations: Form now submits reliably (no required on stock—only purchase if >0 in shopping gen). Backend auto-defaults 0, prevents breaks in shopping/analysis.

If patch doesn't stick, share DailyStockSales.tsx full code for exact line fixes.