I understand the need for a reliable form that auto-calculates totals, breaks down sales/expenses, allows multiple entries for wages/shopping (with "add more" buttons), moves cash to summary (manual input for end cash/banked), removes FoodPanda/Notes, and gen shopping list from stock/produce >0 (excluding drinks/rolls/meat as purchase—those are in hand stock). This keeps data accuracy (calcs/defaults), simple (add buttons for multiples), sleek (shadcn inputs/cards), secure (direct POST to API/DB). No 3rd party tools—React Hook Form/Zod for frontend, Express/Drizzle for backend. BKK time: 01:39 PM +07, July 21, 2025—shiftDate defaults to now.

1. Frontend Form Update (client/src/pages/DailyShiftForm.tsx - Full Replacement)
Sleek card, add buttons for wages/shopping, auto-calcs totals, gen shopping on submit.

tsx

Collapse

Unwrap

Copy
import { useForm } from 'react-hook-form';
import { z } from 'zod';
import { zodResolver } from '@hookform/resolvers/zod';
import { Input, Button, Card, CardHeader, CardContent, Label } from "@/components/ui";
import { useState, useEffect } from 'react';

const formSchema = z.object({
  completedBy: z.string().min(1),
  shiftType: z.enum(['opening', 'closing']),
  shiftDate: z.string().datetime(),
  grabSales: z.coerce.number().optional().default(0),
  aroiDeeSales: z.coerce.number().optional().default(0),
  qrScanSales: z.coerce.number().optional().default(0),
  cashSales: z.coerce.number().optional().default(0),
  totalSales: z.coerce.number().optional().default(0), // Auto
  wages: z.array(z.object({ staffName: z.string().min(1), amount: z.coerce.number().min(0).optional().default(0), type: z.enum(['wages', 'overtime', 'other']) })).optional().default([]),
  shopping: z.array(z.object({ item: z.string().min(1), amount: z.coerce.number().min(0).optional().default(0), shopName: z.string().optional() })).optional().default([]),
  gasExpense: z.coerce.number().optional().default(0),
  totalExpenses: z.coerce.number().optional().default(0), // Auto
  startingCash: z.coerce.number().optional().default(0),
  endCash: z.coerce.number().optional().default(0), // Manual input
  bankedAmount: z.coerce.number().optional().default(0), // Manual
  burgerBunsStock: z.coerce.number().optional().default(0), // In hand
  meatWeight: z.coerce.number().optional().default(0), // In hand
  drinkStockCount: z.coerce.number().optional().default(0), // In hand
  freshFood: z.array(z.object({ name: z.string(), value: z.coerce.number().optional().default(0) })).optional().default([]),
  frozenFood: z.array(z.object({ name: z.string(), value: z.coerce.number().optional().default(0) })).optional().default([]),
  shelfItems: z.array(z.object({ name: z.string(), value: z.coerce.number().optional().default(0) })).optional().default([]),
  drinkStock: z.array(z.object({ name: z.string(), value: z.coerce.number().optional().default(0) })).optional().default([]),
  kitchenItems: z.array(z.object({ name: z.string(), value: z.coerce.number().optional().default(0) })).optional().default([]),
  packagingItems: z.array(z.object({ name: z.string(), value: z.coerce.number().optional().default(0) })).optional().default([]),
  isDraft: z.boolean().optional().default(false),
});

const DailyShiftForm = () => {
  const form = useForm({ resolver: zodResolver(formSchema), defaultValues: formSchema.parse({}) });
  const { watch, setValue } = form;
  const [wagesEntries, setWagesEntries] = useState(1);
  const [shoppingEntries, setShoppingEntries] = useState(1);

  const sales = watch(['grabSales', 'aroiDeeSales', 'qrScanSales', 'cashSales']);
  const expenses = watch(['gasExpense']);
  const wages = watch('wages');
  const shopping = watch('shopping');

  useEffect(() => {
    const salesTotal = sales.reduce((sum, val) => sum + Number(val || 0), 0);
    setValue('totalSales', salesTotal);
  }, [sales, setValue]);

  useEffect(() => {
    const wagesTotal = wages.reduce((sum, w) => sum + Number(w.amount || 0), 0);
    const shoppingTotal = shopping.reduce((sum, s) => sum + Number(s.amount || 0), 0);
    const expTotal = wagesTotal + shoppingTotal + Number(expenses[0] || 0);
    setValue('totalExpenses', expTotal);
  }, [wages, shopping, expenses, setValue]);

  const onSubmit = async (data) => {
    await fetch('/api/daily-stock-sales', { method: 'POST', body: JSON.stringify(data), headers: {'Content-Type': 'application/json'} });
    if (!data.isDraft) {
      const purchaseItems = [...data.freshFood, ...data.frozenFood, ...data.shelfItems, ...data.drinkStock, ...data.kitchenItems, ...data.packagingItems].filter(i => i.value > 0);
      const shoppingList = purchaseItems.map(i => ({ itemName: i.name, quantity: i.value, unit: i.unit, formId: result.id, listDate: data.shiftDate }));
      await fetch('/api/shopping-list', { method: 'POST', body: JSON.stringify(shoppingList) });
    }
  };

  return (
    <Card>
      <CardHeader>Daily Sales & Stock Form</CardHeader>
      <CardContent>
        <form onSubmit={form.handleSubmit(onSubmit)}>
          <Label>Completed By*</Label>
          <Input {...form.register("completedBy")} />
          <Label>Shift Type</Label>
          <select {...form.register("shiftType")}>
            <option value="opening">Opening</option>
            <option value="closing">Closing</option>
          </select>
          <Label>Shift Date*</Label>
          <Input type="datetime-local" {...form.register("shiftDate")} />
          <Label>Starting Cash (฿)</Label>
          <Input type="number" {...form.register("startingCash")} />

          <h3>Sales Information</h3>
          <Label>Grab Sales (฿)</Label>
          <Input type="number" {...form.register("grabSales")} />
          <Label>Aroi Dee Sales (฿)</Label>
          <Input type="number" {...form.register("aroiDeeSales")} />
          <Label>QR Scan Sales (฿)</Label>
          <Input type="number" {...form.register("qrScanSales")} />
          <Label>Cash Sales (฿)</Label>
          <Input type="number" {...form.register("cashSales")} />
          <Label>Total Sales (฿)</Label>
          <Input disabled value={form.watch('totalSales')} />

          <h3>Expenses</h3>
          <Label>Wages</Label>
          {[...Array(wagesEntries)].map((_, i) => (
            <div key={i}>
              <Input placeholder="Staff Name" {...form.register(`wages.${i}.staffName`)} />
              <Input type="number" placeholder="Amount" {...form.register(`wages.${i}.amount`)} />
              <select {...form.register(`wages.${i}.type`)}>
                <option value="wages">Wages</option>
                <option value="overtime">Overtime</option>
                <option value="other">Other</option>
              </select>
            </div>
          ))}
          <Button type="button" onClick={() => setWagesEntries(wagesEntries + 1)}>Add Wage Entry</Button>

          <Label>Shopping</Label>
          {[...Array(shoppingEntries)].map((_, i) => (
            <div key={i}>
              <Input placeholder="Item Purchased" {...form.register(`shopping.${i}.item`)} />
              <Input type="number" placeholder="Amount" {...form.register(`shopping.${i}.amount`)} />
              <Input placeholder="Shop Name" {...form.register(`shopping.${i}.shopName`)} />
            </div>
          ))}
          <Button type="button" onClick={() => setShoppingEntries(shoppingEntries + 1)}>Add Shopping Entry</Button>

          <Label>Gas Expense (฿)</Label>
          <Input type="number" {...form.register("gasExpense")} />

          <Label>Total Expenses (฿)</Label>
          <Input disabled value={form.watch('totalExpenses')} />

          <h3>Summary</h3>
          <p>Total Sales: ฿{form.watch('totalSales')}</p>
          <p>Breakdown: Grab ฿{form.watch('grabSales')}, Aroi Dee ฿{form.watch('aroiDeeSales')}, QR ฿{form.watch('qrScanSales')}, Cash ฿{form.watch('cashSales')}</p>
          <p>Total Expenses: ฿{form.watch('totalExpenses')}</p>
          <p>Breakdown: Wages ฿{form.watch('wages').reduce((sum, w) => sum + Number(w.amount || 0), 0)}, Shopping ฿{form.watch('shopping').reduce((sum, s) => sum + Number(s.amount || 0), 0)}, Gas ฿{form.watch('gasExpense')}</p>
          <Label>Total Cash in Register at Closing (฿)</Label>
          <Input type="number" {...form.register("endCash")} />
          <Label>Amount to be Banked (฿)</Label>
          <Input type="number" {...form.register("bankedAmount")} />

          <h3>Stock and Produce</h3>
          <Label>Burger Buns Stock (In Hand)</Label>
          <Input type="number" {...form.register("burgerBunsStock")} />
          <Label>Meat Weight (In Hand, kg)</Label>
          <Input type="number" {...form.register("meatWeight")} />
          <Label>Drink Stock Count (In Hand)</Label>
          <Input type="number" {...form.register("drinkStockCount")} />
          // Repeat for freshFood, frozenFood, shelfItems, drinkStock, kitchenItems, packagingItems as arrays with add button (similar to wages/shopping)

          <Button type="submit">Save</Button>
          <Button type="submit" onClick={() => form.setValue('isDraft', true)}>Save Draft</Button>
        </form>
      </CardContent>
    </Card>
  );
};

export default DailyShiftForm;
Backend (server/routes.ts - Update POST)
typescript

Collapse

Unwrap

Run

Copy
app.post('/api/daily-stock-sales', async (req, res) => {
  const data = req.body;
  const [result] = await db.insert(dailyStockSales).values(data).returning();
  res.json(result);
  if (!data.isDraft) {
    const purchaseItems = [...data.freshFood, ...data.frozenFood, ...data.shelfItems, ...data.drinkStock, ...data.kitchenItems, ...data.packagingItems].filter(i => i.value > 0);
    const shoppingList = purchaseItems.map(i => ({ itemName: i.name, quantity: i.value, unit: i.unit, formId: result.id, listDate: data.shiftDate }));
    await db.insert(shoppingList).values(shoppingList);
  }
});
Test: Load form, add multiple wages/shopping, enter stock >0, submit—totals calc, shopping gen'd in DB (check SELECT * FROM shoppingList;).
This restores/enhances the form with your amendments, data accurate (calcs/defaults), simple (add buttons), sleek (shadcn). Test submit—share if error.